<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Reforma e Ampliação</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .card {
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            padding: 1.5rem;
            transition: transform 0.2s;
        }
        .card:hover {
            transform: translateY(-5px);
        }
        .btn {
            transition: background-color 0.3s;
        }
    </style>
</head>
<body class="p-4 sm:p-6 lg:p-8">
    <div class="max-w-7xl mx-auto">
        <!-- Cabeçalho -->
        <header class="mb-8">
            <h1 class="text-3xl font-bold text-gray-800">Dashboard de Acompanhamento de Obra</h1>
            <p class="text-gray-500 mt-1">Projeto de Reforma e Ampliação da Casa</p>
        </header>

        <!-- Métricas Principais -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="card flex flex-col justify-between">
                <h2 class="text-lg font-semibold text-gray-600">Custo Total do Projeto</h2>
                <p id="total-cost" class="text-4xl font-bold text-blue-600 mt-2">R$ 0,00</p>
            </div>
            <div class="card">
                <h2 class="text-lg font-semibold text-gray-600 mb-3">Prazo da Fase 1 (Reforma)</h2>
                <div class="flex justify-around text-center">
                    <div>
                        <p class="text-sm text-gray-500">Executados</p>
                        <p id="days-executed" class="text-4xl font-bold text-blue-600">--</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">Restantes</p>
                        <p id="days-left" class="text-4xl font-bold text-green-600">--</p>
                    </div>
                </div>
                <p id="total-days-project" class="text-xs text-gray-400 text-center mt-3">Total: -- dias</p>
            </div>
            <div class="card flex flex-col justify-between text-sm">
                <h2 class="text-lg font-semibold text-gray-600 mb-2">Linha do Tempo</h2>
                <div class="space-y-2">
                    <p><strong>Início do Projeto:</strong> 01/10/2025</p>
                    <p><strong>Fim da Reforma:</strong> 20/12/2025</p>
                    <p><strong>Início da Ampliação:</strong> 01/01/2026</p>
                </div>
            </div>
        </div>

        <!-- Seção Principal: Formulário, Custos e Gráfico -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Coluna de Lançamento e Histórico -->
            <div class="lg:col-span-2 space-y-6">
                <!-- Formulário de Lançamento de Despesa -->
                <div class="card">
                    <h2 class="text-xl font-bold text-gray-800 mb-4">Adicionar Nova Despesa</h2>
                    <form id="expense-form" class="space-y-4">
                        <div>
                            <label for="description" class="block text-sm font-medium text-gray-700">Descrição</label>
                            <input type="text" id="description" name="description" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm p-2">
                        </div>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div>
                                <label for="amount" class="block text-sm font-medium text-gray-700">Valor (R$)</label>
                                <input type="number" id="amount" name="amount" step="0.01" min="0" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm p-2">
                            </div>
                            <div>
                                <label for="category" class="block text-sm font-medium text-gray-700">Categoria</label>
                                <select id="category" name="category" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm p-2 bg-white">
                                    <option value="Equipamento">Equipamento</option>
                                    <option value="Alimentação">Alimentação</option>
                                    <option value="Combustível">Combustível</option>
                                    <option value="Transporte Público">Transporte Público</option>
                                    <option value="Transporte por App">Transporte por App</option>
                                    <option value="Materiais">Materiais de Construção</option>
                                    <option value="Mão de Obra">Mão de Obra</option>
                                    <option value="Outros">Outros</option>
                                </select>
                            </div>
                        </div>
                         <div>
                            <label for="date" class="block text-sm font-medium text-gray-700">Data</label>
                            <input type="date" id="date" name="date" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm p-2">
                        </div>
                        <button type="submit" class="w-full sm:w-auto btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                            Adicionar Despesa
                        </button>
                    </form>
                </div>

                <!-- Histórico de Despesas -->
                <div class="card">
                    <h2 class="text-xl font-bold text-gray-800 mb-4">Histórico de Lançamentos</h2>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Data</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Descrição</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Categoria</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Valor</th>
                                </tr>
                            </thead>
                            <tbody id="expense-list" class="bg-white divide-y divide-gray-200">
                                <!-- As linhas de despesa serão inseridas aqui -->
                                <tr id="no-expenses-row">
                                    <td colspan="4" class="px-6 py-4 text-center text-gray-500">Nenhuma despesa lançada ainda.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Coluna de Custos por Categoria e Gráfico -->
            <div class="space-y-6">
                <div class="card">
                    <h2 class="text-xl font-bold text-gray-800 mb-4">Custos por Categoria</h2>
                    <div id="category-costs" class="space-y-3">
                        <!-- Os custos por categoria serão inseridos aqui -->
                    </div>
                </div>
                <div class="card">
                    <h2 class="text-xl font-bold text-gray-800 mb-4">Distribuição de Custos</h2>
                    <div class="relative h-64 md:h-80">
                         <canvas id="costs-chart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Dados iniciais carregados da sua planilha CSV
            const initialData = [
              { "date": "2025-10-01", "amount": 43.00, "category": "Alimentação", "description": "Almoço com Renato" },
              { "date": "2025-10-01", "amount": 13.00, "category": "Equipamento", "description": "Dois pares de luvas" },
              { "date": "2025-10-01", "amount": 20.00, "category": "Equipamento", "description": "Dez sacos de entulho" },
              { "date": "2025-10-02", "amount": 45.00, "category": "Alimentação", "description": "Almoço com Renato" },
              { "date": "2025-10-02", "amount": 36.71, "category": "Alimentação", "description": "água, copo, sabonete e papel" },
              { "date": "2025-10-02", "amount": 7.29, "category": "Equipamento", "description": "óculos de proteção" },
              { "date": "2025-10-02", "amount": 100.00, "category": "Transporte Público", "description": "recarga dos bilhetes" },
              { "date": "2025-10-02", "amount": 50.00, "category": "Combustível", "description": "gasolina do Renato" },
              { "date": "2025-10-04", "amount": 84.90, "category": "Equipamento", "description": "alicate nivelador" },
              { "date": "2025-10-04", "amount": 19.90, "category": "Equipamento", "description": "colher de pedreiro" },
              { "date": "2025-10-04", "amount": 31.90, "category": "Equipamento", "description": "desempenadeira" },
              { "date": "2025-10-04", "amount": 227.48, "category": "Materiais", "description": "Cimento, espaçadores, etc" }
            ];

            // Estado da aplicação
            let expenses = [...initialData]; // Inicia com os dados da planilha
            let chart;

            const categories = [
                "Equipamento", "Alimentação", "Combustível", "Transporte Público", 
                "Transporte por App", "Materiais", "Mão de Obra", "Outros"
            ];
            
            const categoryColors = {
                "Equipamento": 'rgba(255, 99, 132, 0.8)',
                "Alimentação": 'rgba(54, 162, 235, 0.8)',
                "Combustível": 'rgba(255, 206, 86, 0.8)',
                "Transporte Público": 'rgba(75, 192, 192, 0.8)',
                "Transporte por App": 'rgba(153, 102, 255, 0.8)',
                "Materiais": 'rgba(255, 159, 64, 0.8)',
                "Mão de Obra": 'rgba(199, 199, 199, 0.8)',
                "Outros": 'rgba(83, 102, 84, 0.8)'
            };

            // Elementos do DOM
            const totalCostEl = document.getElementById('total-cost');
            const daysLeftEl = document.getElementById('days-left');
            const daysExecutedEl = document.getElementById('days-executed');
            const totalDaysProjectEl = document.getElementById('total-days-project');
            const form = document.getElementById('expense-form');
            const expenseListEl = document.getElementById('expense-list');
            const categoryCostsEl = document.getElementById('category-costs');
            const noExpensesRow = document.getElementById('no-expenses-row');

            // Função para formatar moeda
            const formatCurrency = (value) => {
                return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(value);
            };

            // Função para calcular dias restantes
            const calculateDaysLeft = () => {
                const startDate = new Date('2025-10-01T00:00:00');
                const deadline = new Date('2025-12-20T23:59:59');
                const today = new Date();
                const msPerDay = 1000 * 60 * 60 * 24;

                const totalDays = Math.round((deadline - startDate) / msPerDay);

                let executedDays = 0;
                if (today >= startDate) {
                    executedDays = Math.round((today - startDate) / msPerDay) + 1;
                }
                if (executedDays > totalDays) executedDays = totalDays;

                let remainingDays = 0;
                if (today < deadline) {
                    remainingDays = Math.ceil((deadline - today) / msPerDay);
                }
                
                daysExecutedEl.textContent = executedDays > 0 ? executedDays : '0';
                daysLeftEl.textContent = remainingDays > 0 ? remainingDays : '0';
                totalDaysProjectEl.textContent = `Total: ${totalDays} dias de projeto`;
            };

            // Função para renderizar o gráfico
            const renderChart = (categoryTotals) => {
                const ctx = document.getElementById('costs-chart').getContext('2d');
                const labels = Object.keys(categoryTotals);
                const data = Object.values(categoryTotals);
                const backgroundColors = labels.map(label => categoryColors[label] || '#cccccc');

                if (chart) {
                    chart.destroy();
                }

                chart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Custo por Categoria',
                            data: data,
                            backgroundColor: backgroundColors,
                            borderColor: '#ffffff',
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 15,
                                    boxWidth: 12
                                }
                            }
                        }
                    }
                });
            };

            // Função principal para atualizar o dashboard
            const updateDashboard = () => {
                const totalCost = expenses.reduce((sum, exp) => sum + exp.amount, 0);
                const categoryTotals = expenses.reduce((acc, exp) => {
                    if (!acc[exp.category]) {
                        acc[exp.category] = 0;
                    }
                    acc[exp.category] += exp.amount;
                    return acc;
                }, {});
                totalCostEl.textContent = formatCurrency(totalCost);
                expenseListEl.innerHTML = '';
                if (expenses.length === 0) {
                    expenseListEl.appendChild(noExpensesRow);
                } else {
                    const sortedExpenses = [...expenses].sort((a, b) => new Date(b.date) - new Date(a.date));
                    sortedExpenses.forEach(exp => {
                        const row = document.createElement('tr');
                        const formattedDate = new Date(exp.date + 'T00:00:00-03:00').toLocaleDateString('pt-BR');
                        row.innerHTML = `
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${formattedDate}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${exp.description}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${exp.category}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right font-medium">${formatCurrency(exp.amount)}</td>
                        `;
                        expenseListEl.appendChild(row);
                    });
                }
                categoryCostsEl.innerHTML = '';
                categories.forEach(cat => {
                    const cost = categoryTotals[cat] || 0;
                    if (cost > 0) {
                         const div = document.createElement('div');
                         div.className = 'flex justify-between items-center text-sm';
                         div.innerHTML = `
                            <span class="text-gray-700">${cat}</span>
                            <span class="font-semibold text-gray-800">${formatCurrency(cost)}</span>
                         `;
                         categoryCostsEl.appendChild(div);
                    }
                });
                 if (Object.keys(categoryTotals).length === 0) {
                    categoryCostsEl.innerHTML = '<p class="text-center text-gray-500 text-sm">Nenhum custo por categoria.</p>';
                 }
                renderChart(categoryTotals);
            };
            
            form.addEventListener('submit', (e) => {
                e.preventDefault();
                const newExpense = {
                    description: form.description.value,
                    amount: parseFloat(form.amount.value),
                    category: form.category.value,
                    date: form.date.value
                };
                expenses.push(newExpense);
                form.reset();
                form.date.valueAsDate = new Date();
                updateDashboard();
            });

            // Inicialização
            calculateDaysLeft();
            form.date.valueAsDate = new Date();
            updateDashboard();
            setInterval(calculateDaysLeft, 60000);
        });
    </script>
</body>
</html>

